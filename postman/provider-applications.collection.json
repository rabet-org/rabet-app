{
  "info": {
    "_postman_id": "rabet-provider-applications",
    "name": "Rabet â€” Provider Applications",
    "description": "Provider application endpoints.\n\n**Flow:** Register â†’ Login â†’ Submit Application â†’ (Admin) Review â†’ Provider Profile created.\n\nRequires a valid `accessToken` from the Auth collection.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:3000/api",
      "type": "string"
    },
    { "key": "accessToken", "value": "", "type": "string" },
    { "key": "applicationId", "value": "", "type": "string" },
    { "key": "adminAccessToken", "value": "", "type": "string" }
  ],
  "item": [
    {
      "name": "4.0 Upload File",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status is 200 OK', () => pm.response.to.have.status(200));",
              "if (pm.response.code === 200) {",
              "  const res = pm.response.json();",
              "  console.log('âœ… Uploaded:', res.url);",
              "}"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          { "key": "Authorization", "value": "Bearer {{accessToken}}" }
        ],
        "url": {
          "raw": "{{baseUrl}}/upload",
          "host": ["{{baseUrl}}"],
          "path": ["upload"]
        },
        "body": {
          "mode": "formdata",
          "formdata": [
            { "key": "file", "type": "file", "src": "" },
            { "key": "folder", "type": "text", "value": "provider-docs" }
          ]
        }
      }
    },
    {
      "name": "4.1 Submit Application",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status is 201 Created', () => pm.response.to.have.status(201));",
              "if (pm.response.code === 201) {",
              "  const res = pm.response.json();",
              "  pm.collectionVariables.set('applicationId', res.id ?? '');",
              "  console.log('âœ… Application submitted:', res.id);",
              "  console.log('â„¹ï¸  Status:', res.application_status);",
              "}"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/json" },
          { "key": "Authorization", "value": "Bearer {{accessToken}}" }
        ],
        "url": {
          "raw": "{{baseUrl}}/provider-applications",
          "host": ["{{baseUrl}}"],
          "path": ["provider-applications"]
        },
        "body": {
          "mode": "raw",
          "raw": "{\n  \"provider_type\": \"agency\",\n  \"business_name\": \"Creative Agency Inc.\",\n  \"description\": \"Full-service creative agency with 5+ years of experience in digital marketing, web design, and branding. We deliver premium results for businesses of all sizes.\",\n  \"portfolio_url\": \"https://creativeagency.com\",\n  \"verification_docs\": {\n    \"business_license_url\": \"https://res.cloudinary.com/demo/raw/upload/sample.pdf\",\n    \"tax_id\": \"123456789\"\n  }\n}"
        }
      }
    },
    {
      "name": "4.2 Get My Application",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status is 200 OK', () => pm.response.to.have.status(200));",
              "if (pm.response.code === 200) {",
              "  const res = pm.response.json();",
              "  pm.collectionVariables.set('applicationId', res.id ?? '');",
              "  console.log('â„¹ï¸  Status:', res.application_status);",
              "  if (res.rejection_reason) console.log('âŒ Rejection:', res.rejection_reason);",
              "}"
            ]
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          { "key": "Authorization", "value": "Bearer {{accessToken}}" }
        ],
        "url": {
          "raw": "{{baseUrl}}/provider-applications/me",
          "host": ["{{baseUrl}}"],
          "path": ["provider-applications", "me"]
        }
      }
    },
    {
      "name": "4.3 Update My Application",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status is 200 OK', () => pm.response.to.have.status(200));",
              "if (pm.response.code === 200) {",
              "  console.log('âœ… Application updated. Status:', pm.response.json().application_status);",
              "}"
            ]
          }
        }
      ],
      "request": {
        "method": "PATCH",
        "header": [
          { "key": "Content-Type", "value": "application/json" },
          { "key": "Authorization", "value": "Bearer {{accessToken}}" }
        ],
        "url": {
          "raw": "{{baseUrl}}/provider-applications/me",
          "host": ["{{baseUrl}}"],
          "path": ["provider-applications", "me"]
        },
        "body": {
          "mode": "raw",
          "raw": "{\n  \"description\": \"Updated description â€” full-service creative agency with 5+ years of experience in digital marketing, web design, and branding. We deliver premium results.\",\n  \"portfolio_url\": \"https://newportfolio.com\"\n}"
        }
      }
    },
    {
      "name": "â”€â”€â”€â”€â”€ Admin â”€â”€â”€â”€â”€",
      "request": {
        "method": "GET",
        "url": { "raw": "{{baseUrl}}", "host": ["{{baseUrl}}"] }
      }
    },
    {
      "name": "4.4 [Admin] List Applications",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status is 200 OK', () => pm.response.to.have.status(200));",
              "if (pm.response.code === 200) {",
              "  const res = pm.response.json();",
              "  console.log('â„¹ï¸  Total applications:', res.pagination.total);",
              "  res.data.forEach(a => console.log(`  ${a.business_name} â€” ${a.application_status}`));",
              "  if (res.data.length > 0) {",
              "    pm.collectionVariables.set('applicationId', res.data[0].id);",
              "    console.log('ðŸ“‹ First application ID saved:', res.data[0].id);",
              "  }",
              "}"
            ]
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          { "key": "Authorization", "value": "Bearer {{adminAccessToken}}" }
        ],
        "url": {
          "raw": "{{baseUrl}}/admin/provider-applications?status=pending&page=1&limit=20",
          "host": ["{{baseUrl}}"],
          "path": ["admin", "provider-applications"],
          "query": [
            { "key": "status", "value": "pending" },
            { "key": "page", "value": "1" },
            { "key": "limit", "value": "20" }
          ]
        }
      }
    },
    {
      "name": "4.5 [Admin] Approve Application",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "type": "text/javascript",
            "exec": [
              "const id = pm.collectionVariables.get('applicationId');",
              "if (!id) console.warn('âš ï¸  applicationId is empty â€” run List or Submit first');"
            ]
          }
        },
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status is 200 OK', () => pm.response.to.have.status(200));",
              "if (pm.response.code === 200) {",
              "  console.log('âœ…', pm.response.json().message);",
              "}"
            ]
          }
        }
      ],
      "request": {
        "method": "PATCH",
        "header": [
          { "key": "Content-Type", "value": "application/json" },
          { "key": "Authorization", "value": "Bearer {{adminAccessToken}}" }
        ],
        "url": {
          "raw": "{{baseUrl}}/provider-applications/{{applicationId}}/review",
          "host": ["{{baseUrl}}"],
          "path": ["provider-applications", "{{applicationId}}", "review"]
        },
        "body": {
          "mode": "raw",
          "raw": "{\n  \"action\": \"approve\"\n}"
        }
      }
    },
    {
      "name": "4.6 [Admin] Reject Application",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "type": "text/javascript",
            "exec": [
              "const id = pm.collectionVariables.get('applicationId');",
              "if (!id) console.warn('âš ï¸  applicationId is empty â€” run List or Submit first');"
            ]
          }
        },
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status is 200 OK', () => pm.response.to.have.status(200));",
              "if (pm.response.code === 200) {",
              "  console.log('âœ…', pm.response.json().message);",
              "}"
            ]
          }
        }
      ],
      "request": {
        "method": "PATCH",
        "header": [
          { "key": "Content-Type", "value": "application/json" },
          { "key": "Authorization", "value": "Bearer {{adminAccessToken}}" }
        ],
        "url": {
          "raw": "{{baseUrl}}/provider-applications/{{applicationId}}/review",
          "host": ["{{baseUrl}}"],
          "path": ["provider-applications", "{{applicationId}}", "review"]
        },
        "body": {
          "mode": "raw",
          "raw": "{\n  \"action\": \"reject\",\n  \"rejection_reason\": \"Insufficient documentation. Please upload a valid business license.\"\n}"
        }
      }
    }
  ]
}
